---
title: "Summary of simulation results under scenario Ks1-Low"
author: "wei zou"
date: "`r Sys.time()`"
output: pdf_document
---


Output is generated by `r knitr::current_input()` at `r getwd()` from `r R.version.string`. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)


spec <- list( home = '~/aPDL1/oak', job  = 'change_all3_2c_ks_kg0.01',batchSize = 10, seedBase=27519, numValidation = 5, duplicates_for_meta_regression=3, jobName='Ks1-low', pd.var='ks_trt', extractPos=c(alpha=6, ks_trt = 7,beta1 = 8))

spec$totalIter <- (1 + spec$numValidation) * spec$batchSize * 5

library(knitr)
library(plyr)
library(ggplot2)
library(reshape2)
library(grid)
source('~/R/lib_2020/data_functions.r')
source('~/R/lib_2020/output_functions.r')
source('~/R/lib_2020/yyboxplot.r')
source('~/R/lib_2020/violin.r')
source('~/aPDL1/oak/simsurv_functions.r')

sum2 <- function(x, digits=2, applyUniqueBeforeConcatenate=F){
  stopifnot(is.matrix(x))
  apply(x, 2, function(x){
    if(length(unique(x)) == 1){
      round(x[1], digits)
    }else {
       if( applyUniqueBeforeConcatenate){
         paste(' ',paste(unique(round(x, digits)), collapse = ' / ', sep=''))
       }else{
         paste(' ',paste(round(x, digits), collapse = ' / ', sep=''))
         } 
    }
      })
}

```

 

```{r load sim results, echo=F}
r1 <- readFolder.rdata( path= paste(spec$home,'results', spec$job, sep='/'), pattern = paste( '\\.Rdata', sep=''), extractPos =spec$extractPos, objName ='s1')
 
print( paste( '# of simulations per parameter setting. Column heads indicate different values of', spec$pd.var))
with(r1, table(alpha, r1[, spec$pd.var], beta1))

p1 <- readFolder.rdata( path= paste(spec$home,'results', spec$job, sep='/'), pattern = paste( '\\.Rdata', sep=''), extractPos =c(), objName ="para_template_biexp")
stopifnot(!any(duplicated(p1$fileName)))
row.names(p1) <- as.character(p1$fileName)
p1 <- p1[, setdiff(colnames(p1),'fileName')]
p2 <- data.frame(sum2(as.matrix(unique(p1)), digits=3, applyUniqueBeforeConcatenate = T))

row.names(p2) <- gsub('betaEvent_intercept' ,'beta_0',
                      gsub('betaEvent_trt','beta_1',
                           gsub('ks_omega','SD of random effect on ks',
                                gsub('kg_omega','SD of random effect on kg',
                                     gsub('measure_sd','SD for error', row.names(p2))))))
kable(p2 , col.names = 'Values', caption = paste('Parameter values in simulation', spec$jobName))

r1$beta1 <- factor(as.numeric(r1$beta1))

```

# trajectories

```{r}

fup <- with(r1, tapply(max_fup, list(alpha, ks_trt, beta1), mean))

fup1 <- fup['0',,'0'] 

vlist <- lapply( split(p1, p1[[spec$pd.var]]), function(p2){
  p2 <- unique(subset(p2, betaEvent_trt ==0 & alpha==0))
  p3 <- unlist(p2)
  for (v in c('ks_omega','kg_omega'   )) p3[v] <- 0
  ctrl.pd <- gsub('trt','soc', spec$pd.var)
  p3[ctrl.pd] <-p3[ctrl.pd] * 1.05
 
  sim2_be(lm=fup1[as.character(unname(p3[spec$pd.var]))], N =2, para=p3, maxt=120, returnData = 'trajectory')
  
  })

multiTrajectory(vlist, main=paste('trajectories from', spec$jobName), legPos = 'bottomleft')


```

x axis extends to the mean follow up time when both alpha =0 and beta_1= 0. A small noise is added to the SOC arm.

 
# Patient level association metrics are correlated

## correlation summarized from studies simulated under identical parameters

```{r}



 tab1 <- t( sapply(split(r1, list(r1$alpha, r1$beta1, r1[, spec$pd.var])), function(x) {
 
    with(x, c(beta1=unique(as.numeric(as.character(beta1))), 
              alpha=unique(as.numeric(as.character(alpha))),
              pd.var= as.numeric(unique(x[, spec$pd.var])), 
              ibs=cor(ibs.original, c_rfs, method = 'spearman'), 
              ibs.scaled=cor(ibs.scaled, c_rfs, method = 'spearman'), 
              beta = cor(bmHR_stratifi_by_trt.bm,c_rfs, method = 'spearman'), n=nrow(x) ))
    }    ))
 
 
 sum1 <- function(x, digits=2){
   q1 <- round(quantile(x, probs=c(0.25, 0.5, 0.75)), digits)
   paste(q1[2], ' (',q1[1],', ',q1[3],')', sep='')
   }
 
 tab1b <- t (sapply(split(as.data.frame(tab1),  tab1[,'alpha'] ), function(x){
  c(
     
    ibs=sum1(x[,'ibs']),
   ibs.scaled = sum1(x[,'ibs.scaled']),
   beta = sum1(x[,'beta']), 
   n=nrow(x))
   
   }))
 
 kable(tab1b, caption = paste('Spearman correlation between C index and other patient level association metrics, grouped by alpha, from Simulation', spec$jobName ))

 write.csv(tab1b, file = paste(spec$home, '/results/', spec$job,'_median_correlation_patient_level_stats.csv', sep=''), row.names=T)

```

We first estimated spearman correlations between C index and other patient level association metrics (indicated in the column head) from 300 trials simulated from identical parameters. Grouped by alpha, we summarized 15 correlation estimates (from 3 values of beta_1 and 5 values of Ks/Kg in the active arm) using the median and their 1st and 3rd quartile (in the parathesis). beta: log(HR) of SE. n: number of correlation estimates underlying the summaries.

\newpage

## correlation summarized across alpha

```{r}
 
  tab3 <- t( sapply(split(r1, list( r1$beta1, r1[, spec$pd.var])), function(x) {
 
    with(x, c(beta1=unique(as.numeric(as.character(beta1))), 
              as.numeric(unique(x[, spec$pd.var])), 
              ibs=cor(ibs.original, c_rfs, method = 'spearman'), 
              ibs.scaled=cor(ibs.scaled, c_rfs, method = 'spearman'), 
              beta = cor(bmHR_stratifi_by_trt.bm,c_rfs, method = 'spearman'), n=nrow(x) ))
    }    ))
 
 kable(tab3, col.names = c('beta_1', spec$pd.var,'IBS','Scaled IBS','log(HR) of SE','n'), row.name=F, digits = 2, caption ='spearman correlation between C index and other patient level metrics across alpha, grouped by beta_1 and Ks/Kg')
 
```

Each correlation in the table above is based on simulated studies illustrated in each panel of figures below.  n: number of simulated studies underlying each correlation.


```{r}
 

print( myScatter(r1, x='c_rfs', y='ibs.original', col.var = 'alpha') +theme_bw() + facet_grid( as.formula(paste( 'beta1~',spec$pd.var))) + ggtitle ( paste('patient level association by',spec$pd.var,'(columns) and beta1 (rows)')) + xlab('C index') + ylab('IBS') )

print( myScatter(r1, x='c_rfs', y='ibs.scaled', col.var = 'alpha') +theme_bw() + facet_grid( as.formula(paste( 'beta1~',spec$pd.var))) + ggtitle ( paste('patient level association by',spec$pd.var,'(columns) and beta1 (rows)'))+ xlab('C index') + ylab('Scaled IBS'))

print( myScatter(r1, x='c_rfs', y='bmHR_stratifi_by_trt.bm', col.var = 'alpha') +theme_bw() + facet_grid( as.formula(paste( 'beta1~',spec$pd.var))) + ggtitle ( paste('patient level association by',spec$pd.var,'(columns) and beta1 (rows)')) + xlab('C index') + ylab('SE log(HR)'))

print( myScatter(r1, x='ibs.original', y='ibs.scaled', col.var = 'alpha') +theme_bw() + facet_grid( as.formula(paste( 'beta1~',spec$pd.var))) + ggtitle ( paste('patient level association by',spec$pd.var,'(columns) and beta1 (rows)')) + xlab('IBS') + ylab('Scaled IBS'))
```

## patient level association increases with alpha

```{r}
col1 <- gplots::colorpanel(n=length(unique(r1$alpha)), low='green', mid='black', high='red')

names(col1) <- unique(r1$alpha)


print( yyboxplot(r1, x='alpha', y='c_rfs', x.sub='beta1', ylab='C index', main= paste('C index distribution by alpha and beta_1 in Simulation', spec$jobName), add.n=F, pch=NA, useCol = T) )

kable( dcast(ddply(r1, .(alpha, beta1) ,function(x) median(x$c_rfs)), alpha~ beta1, value.var='V1'), digits = 2, caption='median C index across all simulated studies')

#print( violinPlot(r1, x ='alpha', y='ibs.original', ylab='IBS', h.facets='beta1', add.n='', main='IBS distribution by alpha and beta1', col=col1) )

print( yyboxplot(r1, x='alpha', y='ibs.original', x.sub='beta1', ylab='IBS', main=paste('IBS distribution by alpha and beta_1 in Simulation', spec$jobName), add.n=F, pch=NA, useCol = T) )

kable( dcast(ddply(r1, .(alpha, beta1) ,function(x) median(x$ibs.original)), alpha~ beta1, value.var='V1'), digits = 2, caption='median IBS across all simulated studies')


#print(violinPlot(r1, x ='alpha', y='bmHR_stratifi_by_trt.bm', ylab='SE log(HR)', h.facets='beta1', add.n='', main='SE log(HR) distribution by alpha and beta1', col=col1) )

 yyboxplot(r1, x='alpha', y='bmHR_stratifi_by_trt.bm', x.sub='beta1', ylab='SE log(HR)', main=paste('log(HR) of SE distribution by alpha and beta_1 in Simulation', spec$jobName), add.n=F, pch=NA, useCol = T) 

kable( dcast(ddply(r1, .(alpha, beta1) ,function(x) median(x$'bmHR_stratifi_by_trt.bm')), alpha~ beta1, value.var='V1'), digits = 2, caption='median log(HR) of SE across all simulated studies')

```

# trial level association  

## Grouped by unique values of alpha and beta1


```{r,echo=F}


r1$beta1 <- as.character(r1$beta1)

s6  <- pair_simulation2(ds =r1,  pd_mod.var  =spec$pd.var, dup = spec$duplicates_for_meta_regression, strata.var=c('alpha','beta1'), returnSimData=T) 

    set.seed(27519)
s5 <- do.call(rbind, lapply(1:100, function(i) pair_simulation2 (ds=r1, pd_mod.var  =spec$pd.var)))

    set.seed(27519)
s7 <- do.call(rbind, lapply(1:100, function(i) pair_simulation2 (ds=r1, pd_mod.var  =spec$pd.var, dup=spec$duplicates_for_meta_regression )))

``` 

### sampling 3 replicates per Ks/Kg parameter

```{r example data 1, echo=F}
 
ggplot(s6, aes(bm_diff.1, trt_itt.trt)) + geom_point(aes_string(col=spec$pd.var)) + scale_color_manual(values= rainbow(length(unique(s6[, spec$pd.var])))) + facet_grid( beta1~ alpha) + theme_bw() + ggtitle('example sets of studies to estimated R2,stratified by alpha and beta1') + xlab('marginal SE difference across treatment') + ylab('marginal treatment effect') 

```

Each panel includes 15 studies: each study has a different `r spec$pd.var` value in the active arm (indicated by different colors) and has 3 duplicates. Each panel gives one R2 estimation. alpha varies by columns and beta_1 varies by rows. Y axis shows the log(HR) for the treatment. X axis shows the differences in median SE values between the 2 arms.

```{r repeat with dup equal to 3, echo =F}


s7 <- data.frame(s7)
s7$R2 <- s7$cor1^2

 tab4 <- t( sapply(split(s7, s7$beta1), function(x) {
    c1 <- with(x, c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    c2 <- with(subset(x, alpha > 0), c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    c3 <- with(subset(x, alpha > 0.5), c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    sum2(rbind(c1,c2, c3))
    
    
    }
    ))
  
kable( tab4 , caption=paste( 'Spearman correlation between patient level association metric and trial level association metric in Simulation', spec$jobName),  col.names = c('beta_1', 'C index','IBS','Scaled IBS', 'log(HR) of SE','n'), digits = 2, row.names=F)

write.csv(tab4, file =  paste(spec$home, '/results/', spec$job,'_cor_plevel_tlevel.csv', sep=''), row.names=F)

```

We paired each R2 (estimated from one panel of the example figure above) with a patient level association metric simulated under the same alpha and beta_1. We grouped these simulated pairs by beta_1 and summarized their spearman correlation while alpha varies. We used full range of alpha (1st number in the triplet separated by /), or excluded pairs from trials with alpha = 0 (2nd number) or pairs with alpha is 0 or 0.5 (3rd number). n: we simulated 100 pairs for each value of alpha.

```{r}

   s7$alpha <- factor(s7$alpha)
   s7$beta1 <- factor(as.numeric(s7$beta1))
   yyboxplot(s7, x='alpha', y='R2', x.sub='beta1', ylab='R2 for trial level association', add.n=F, pch=NA, useCol = T, main = paste('R2 by alpha and beta_1 in Simulation', spec$jobName)) 

kable( dcast(ddply(s7, .(alpha, beta1) ,function(x) median(x$'R2')), alpha~ beta1, value.var='V1'), digits = 2, caption='median R2 across all simulated trial sets')
   
# show association
#   print( violinPlot(s7, x = 'alpha',y='R2', h.facets = 'beta1', add.n='', ylab='R2 for trial level association', col=col1) )
   
   print( myScatter(s7, x= 'R2', y ='c_rfs', col.var = 'alpha', corMethod='',  main = paste(spec$jobName)) + theme_bw() + xlab('SE Utility (R2)') + ylab('C index') + facet_wrap('beta1') )
   
   print( myScatter(s7, x= 'R2', y ='c_rfs', col.var = 'alpha', corMethod='', showContour = T, main = paste(spec$jobName)) + theme_bw() + xlab('SE Utility (R2)') + ylab('C index') + facet_wrap('beta1') )

```   

n: the total number of simulated pairs across all alpha and beta_1 values. Each pair includes an initial discovery cohort to estimate patient level association and a set of studies to estimate trial level association.  

\newpage
  
```{r}
# IBS   
   print( myScatter(s7, x= 'R2', y ='ibs', col.var = 'alpha', corMethod='',  main = spec$jobName) + theme_bw() + xlab('SE Utility (R2)') + ylab('IBS') + facet_wrap('beta1') )
   
   print( myScatter(s7, x= 'R2', y ='ibs', col.var = 'alpha', corMethod='',  main = spec$jobName, showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('IBS') + facet_wrap('beta1') )

   print( myScatter(s7, x= 'R2', y ='ibs.scaled', col.var = 'alpha', corMethod='',  main = spec$jobName) + theme_bw() + xlab('SE Utility (R2)') + ylab('Scaled IBS') + facet_wrap('beta1') )
   
   print( myScatter(s7, x= 'R2', y ='ibs.scaled', col.var = 'alpha', corMethod='',  main = spec$jobName, showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('Scaled IBS') + facet_wrap('beta1') )

  #log(HR) of Se
      
   print( myScatter(s7, x= 'R2', y ='beta', col.var = 'alpha', corMethod='',  main = spec$jobName) + theme_bw() + xlab('SE Utility (R2)') + ylab('log(HR) of SE') + facet_wrap('beta1') )
   
   print( myScatter(s7, x= 'R2', y ='beta', col.var = 'alpha', corMethod='',  main = spec$jobName, showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('log(HR) of SE') + facet_wrap('beta1') )
    
```
 

### sampling 1 study per Ks/Kg parameter

```{r, echo=F}   
 
s5 <- data.frame(s5)
s5$R2 <- s5$cor1^2
#s5$beta1 <- as.factor(as.numeric(as.character(s5$beta1)))

   s5b <- as.data.frame(s5)
   
   s5b$beta1 <- factor(as.numeric(s5b$beta1))

 tab5 <- t( sapply(split(s5b, s5b$beta1), function(x) {
    c1 <- with(x, c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    c2 <- with(subset(x, alpha > 0), c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    c3 <- with(subset(x, alpha > 0.5), c(beta1=unique(as.numeric(as.character(beta1))), cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(x) ))
    
    sum2(rbind(c1,c2, c3))
    
    
    }
    ))
  
kable( tab5 , caption=paste( 'Spearman correlation between patient level association metric and trial level association metric in Simulation', spec$jobName, '1 replicate'), digits = 2, row.names=F)
   
```


```{r}
    yyboxplot(s5b, x='alpha', y='R2', x.sub='beta1', ylab='R2 for trial level association', add.n=F, pch=NA, useCol = T, main = paste( spec$jobName,'1 replicate' )) 
    
   kable( dcast(ddply(s5b, .(alpha, beta1) ,function(x) median(x$'R2')), alpha~ beta1, value.var='V1'), digits = 2, caption='median R2 across all simulated trial sets')
   
   s5b$alpha <- factor(s5b$alpha)
   
   print( myScatter(s5b, x= 'R2', y ='c_rfs', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate')) + theme_bw() + xlab('SE Utility (R2)') + ylab('C index') + facet_wrap('beta1') )
   print( myScatter(s5b, x= 'R2', y ='c_rfs', col.var = 'alpha',corMethod='',  main = paste(spec$jobName, '1 replicate'), showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('C index') + facet_wrap('beta1') )
   
   print( myScatter(s5b, x= 'R2', y ='ibs', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate')) + theme_bw() + xlab('SE Utility (R2)') + ylab('IBS') + facet_wrap('beta1'))
  print( myScatter(s5b, x= 'R2', y ='ibs', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate'), showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('IBS') + facet_wrap('beta1'))

     print( myScatter(s5b, x= 'R2', y ='ibs.scaled', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate')) + theme_bw() + xlab('SE Utility (R2)') + ylab('Scaled IBS') + facet_wrap('beta1'))
  print( myScatter(s5b, x= 'R2', y ='ibs.scaled', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate'), showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('Scaled IBS') + facet_wrap('beta1'))

    
   print( myScatter(s5b, x= 'R2', y ='beta', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate')) + theme_bw() + xlab('SE Utility (R2)') + ylab('log(HR) of SE')+ facet_wrap('beta1') )
print( myScatter(s5b, x= 'R2', y ='beta', col.var = 'alpha', corMethod='',  main = paste(spec$jobName, '1 replicate'), showContour = T) + theme_bw() + xlab('SE Utility (R2)') + ylab('log(HR) of SE')+ facet_wrap('beta1') )
   

```


## Grouped by alpha


```{r example 2, echo=F}
set.seed(27519)
s4  <- pair_simulation2(ds =r1,  pd_mod.var  =c(spec$pd.var, 'beta1'), dup = 1, strata.var=c('alpha'), returnSimData=T, verbose = 1 )

s4$beta1 <- factor(as.numeric(s4$beta1))

ggplot(s4, aes(bm_diff.1, trt_itt.trt)) + geom_point(aes(col=beta1)) + facet_wrap(~alpha)+ theme_bw() + ggtitle('example sets of studies to estimated R2, stratified by alpha') + xlab('marginal SE difference across treatment') + ylab('marginal treatment effect') + scale_color_manual(values=rainbow(3))

```

Each panel includes 15 studies: each trial has a different `r spec$pd.var` value in the active arm and a different beta_1 value (indicated by different colors). Alpha varies across panels (indicated in the panel heading).

```{r, echo=F}

    set.seed(27519)
s3 <- do.call(rbind, lapply(1:100, function(i) pair_simulation2 (ds=r1, pd_mod.var  =c(spec$pd.var, 'beta1'), dup = 1, strata.var=c('alpha'))))

   s3 <- as.data.frame(s3)
   s3$R2 <- s3$cor1^2
   
tab6 <- rbind(
     with(s3, c(cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n=nrow(s3) )),
    
    with(subset(s3, alpha > 0), c( cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n= sum(alpha > 0) )),
    
    with(subset(s3, alpha > 0.5), c( cindex=cor(R2, c_rfs, method = 'spearman'), ibs=cor(R2, ibs, method = 'spearman'), ibs.scaled=cor(R2, ibs.scaled, method = 'spearman'), beta = cor(R2, beta, method = 'spearman'), n= sum(alpha > 0.5) ))
)

row.names(tab6) <- c('all alpha', 'alpha > 0', 'alpha > 0.5')
     
    
kable( tab6 , caption=paste( 'Spearman correlation between patient level association metric and trial level association metric in Simulation', spec$jobName), col.names = c('C index','IBS','Scaled IBS', 'log(HR) of SE','n'), digits = 2, row.names=T)

yyboxplot(s3, x='alpha', y='R2',  col = col1, ylab='R2 for trial level association', add.n=F, pch=NA, useCol = T, main = paste('R2 by alpha in Simulation', spec$jobName)) 

kable( ddply(s3, .(alpha) ,function(x) median(x$'R2')), col.names = c('alpha','Spearman correlation'), row.names=F,  digits = 2, caption='median R2 across all simulated trial sets')

  s3$alpha <- as.character(s3$alpha)

    print( myScatter(s3,  x = 'R2' ,  y='c_rfs', col.var = 'alpha', corMethod='spearman') + xlab('R2') + ylab('C index') + theme_bw() )
  print( myScatter(s3,  x = 'R2' ,  y='c_rfs', col.var = 'alpha', corMethod='spearman', showContour = T) + xlab('SE Utility (R2)') + ylab('C index') + theme_bw() )
  
  print( myScatter(s3,  x = 'R2' ,  y='ibs', col.var = 'alpha', corMethod='spearman') + xlab('SE Utility (R2)') + ylab('IBS') + theme_bw() )
    print( myScatter(s3,  x = 'R2' ,  y='ibs', col.var = 'alpha', corMethod='spearman',showContour = T) + xlab('SE Utility (R2)') + ylab('IBS') + theme_bw() )
    
  print(myScatter(s3,  x = 'R2' ,  y='beta', col.var = 'alpha', corMethod='spearman') + xlab('SE Utility (R2)') + ylab('log(HR) of SE') + theme_bw())
  
  print( myScatter(s3,  x = 'R2' ,  y='beta', col.var = 'alpha', corMethod='spearman',showContour = T) + xlab('SE Utility (R2)') + ylab('log(HR) of SE') + theme_bw())
  
```

